# 푸시 알림 - 상세 기능 기획서

## 기능 개요
투표 시작, 마감 임박, 결과 발표 시점에 적절한 푸시 알림을 전송하여 사용자 참여도를 높이고 실시간 FOMO를 유발하는 기능

## 상세 기능 명세

### 1. 푸시 알림 유형별 설계

#### 1.1 투표 시작 알림
**발송 대상**: Circle 참여자 전체 (투표 생성자 제외)
**발송 시점**: 투표 생성 즉시

**알림 내용**:
```
🗳️ 새로운 투표가 시작됐어요!
"{질문 내용 (최대 30자까지)}"
지금 바로 참여해보세요! 👆
```

**액션**: 앱 실행 → 해당 투표 화면으로 바로 이동

#### 1.2 마감 임박 알림 (1차)
**발송 대상**: 미참여자만
**발송 시점**: 투표 마감 1시간 전

**알림 내용**:
```
⏰ 투표 마감 1시간 전!
"{질문 내용}"
친구들이 기다리고 있어요 🔥
```

#### 1.3 마감 임박 알림 (2차)
**발송 대상**: 미참여자만 (1차 알림 후에도 미참여)
**발송 시점**: 투표 마감 10분 전

**알림 내용**:
```
🚨 마지막 기회!
"{질문 내용}" 투표 마감 10분 전
놓치면 후회할걸요? 😱
```

#### 1.4 결과 발표 알림
**발송 대상**: Circle 참여자 전체
**발송 시점**: 투표 마감 즉시

**알림 내용**:
```
🎉 투표 결과가 나왔어요!
"{질문 내용}"
궁금하지 않아? 결과 확인하러 가기 ✨
```

### 2. 개인화 푸시 알림

#### 2.1 닉네임 활용
- Circle 내에서 사용하는 닉네임 포함
- 예: "철수야, 새로운 투표가 시작됐어요!"

#### 2.2 투표 참여 패턴 기반
- 자주 참여하는 사용자: 친근한 톤
- 비활성 사용자: 호기심 유발 메시지
- 첫 참여자: 환영 메시지 포함

### 3. 알림 설정 및 개인화

#### 3.1 알림 설정 UI
**Profile 탭 → 알림 설정**
- 전체 알림 ON/OFF
- 투표 시작 알림 ON/OFF  
- 마감 임박 알림 ON/OFF
- 결과 발표 알림 ON/OFF
- 조용한 시간 설정 (22:00~08:00)

#### 3.2 스마트 알림 빈도 조절
- 하루 최대 알림 수 제한 (기본값: 10개)
- 짧은 시간 내 동일 Circle 알림 중복 방지
- 사용자가 알림 끄는 패턴 학습하여 발송 빈도 자동 조절

### 4. 기술적 구현사항

#### 4.1 푸시 알림 시스템 아키텍처
- **Frontend**: Expo Push Notifications SDK 사용
- **Backend**: FCM (Firebase Cloud Messaging) 또는 Expo Push Service
- **스케줄링**: Background job으로 마감 임박 알림 예약
- **개인화**: 사용자별 설정 및 행동 데이터 기반

#### 4.2 푸시 토큰 관리
- 앱 설치/실행 시 푸시 토큰 등록
- 토큰 갱신 자동 처리
- 앱 삭제 시 토큰 무효화 처리

#### 4.3 배치 발송 시스템
- Circle 멤버 수에 따른 배치 사이즈 최적화
- 대량 발송 시 Rate Limiting 고려
- 발송 실패 시 재시도 메커니즘

### 5. 딥링크 및 인앱 라우팅

#### 5.1 알림 터치 시 동작
- **투표 시작/마감 임박**: 해당 투표 상세 페이지
- **결과 발표**: 투표 결과 페이지
- **일반**: Home 탭

#### 5.2 딥링크 구조
```
circly://notification?type=poll&poll_id={id}&action={start|deadline|result}
```

### 6. 알림 성과 측정

#### 6.1 추적 이벤트
- 푸시 알림 발송 성공/실패
- 푸시 알림 오픈율 (클릭율)
- 알림을 통한 앱 실행 → 실제 투표 참여율
- 알림 설정 변경 패턴

#### 6.2 A/B 테스트 대상
- 알림 메시지 톤앤매너 (친근함 vs 호기심)
- 이모지 사용 유무
- 발송 타이밍 (즉시 vs 5분 후)
- 개인화 메시지 vs 일반 메시지

### 7. 사용자 경험 최적화

#### 7.1 알림 피로도 방지
- 같은 투표에 대한 중복 알림 방지
- 사용자가 읽지 않은 알림 누적 시 발송 중단
- "너무 많은 알림" 피드백 수집 및 대응

#### 7.2 중요도 기반 우선순위
1. **High**: 결과 발표 (모든 사용자 관심)
2. **Medium**: 투표 시작 (새로운 콘텐츠)
3. **Low**: 마감 임박 (이미 2번 알림받은 경우)

### 8. 에러 케이스 및 예외 처리

#### 8.1 푸시 발송 실패
- **토큰 무효**: 다음 앱 실행 시 토큰 갱신
- **네트워크 오류**: 최대 3회 재시도
- **플랫폼 오류**: 대체 알림 수단 고려 (인앱 알림)

#### 8.2 사용자 권한 거부
- 푸시 권한 거부 시 인앱 알림 배너로 대체
- 권한 재요청 타이밍 최적화
- 알림 가치 설명하는 온보딩 개선

### 9. 국가별/시간대 고려사항

#### 9.1 한국 사용자 특성
- 학교 시간 (09:00~17:00) 알림 자제
- 늦은 시간 (22:00 이후) 조용한 알림
- 주말/공휴일 활성화 타이밍

#### 9.2 시간대 처리
- 사용자 디바이스 시간대 기준
- 서버 시간과 로컬 시간 동기화
- 해외 사용자 확장 시 다중 시간대 지원

## 개발 우선순위
1. **Phase 1**: 기본 3종 알림 (시작/마감임박/결과) 구현
2. **Phase 2**: 개인화 및 설정 기능
3. **Phase 3**: 스마트 빈도 조절 및 성과 측정
4. **Phase 4**: A/B 테스트 시스템 및 고도화

## 성공 지표
- 푸시 알림 오픈율: 15% 이상
- 알림을 통한 투표 참여율: 25% 이상
- 알림 끄는 사용자 비율: 10% 미만